---
layout: default
title: Contributor License Agreement
permalink: /contributor-license-agreement/
description: feenk’s Contributor License Agreement
image: /assets/pictures/glamoroustoolkit-icon.png
---

<section id="components">
  <div class="container pt-5 pb-5 jumbotron-small">
    <div class="row">
      <div class="col-lg-8">
        <p class="lead">
          Thanks for your interest in contributing!
        </p>
        <p>In the interest of the continued health of the project, feenk (the authors of Glamorous Toolkit) requires all contributors to sign a Contributor License Agreement (CLA).</p>

        <form id="contributorSignature" class="row g-3">
          <div class="col-md-4">
            <label class="form-label">
              Your full name:
              <input type="text" id="name" name="name" required size="20" class="form-control">
            </label>

            <!-- This is not being rendered; fix later -->
            <!-- <div class="valid-feedback">
              Looks good!
            </div> -->
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Your email:
              <input type="email" id="email" name="email" required size="20" class="form-control">
            </label>
          </div>
          <div class="col-md-4">
            <label class="form-label">
              Your GitHub username:
              <input type="text" id="gitHubUsername" name="gitHubUsername" required size="20" class="form-control" disabled>
            </label>
          </div>
          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input is-invalid" type="checkbox" value="" id="agreement-checkbox" aria-describedby="invalidCheck3Feedback" required>
              <label class="form-check-label" for="invalidCheck3">
                Agree to this agreement
              </label>
              <!-- <div id="invalidCheck3Feedback" class="invalid-feedback">
                You must agree before submitting.
              </div> -->
            </div>
          </div>
          <div class="col-12">
            <button class="btn btn-primary" type="submit">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<script src="https://contributor-license-agreement-database.gadget.app/api/client/web.min.js"></script>

<script>
  // create a new instance of the Gadget client at the `api` global connected to the Development environment
  window.api = new Gadget({
    environment: "Development"
    // environment: "Production"
  })

  jQuery(document).ready(function($) {

    const queryParams = new Proxy(new URLSearchParams(window.location.search), {
      get: (searchParams, prop) => searchParams.get(prop),
    });

    const gitHubUsername = queryParams.gitHubUsername;

    const form = $('form#contributorSignature');

    form.find('#gitHubUsername').val(gitHubUsername);

    form.on('submit', async (event) => {
      event.preventDefault(); // prevent the form from submitting normally

      const name = form.find('#name').val();
      const email = form.find('#email').val();
      const gitHubUsername = form.find('#gitHubUsername').val();

      try {
        const agreementAgreedTo = form.find('#agreement-checkbox').prop("checked");
        if (!agreementAgreedTo) {
          throw new Error("Agreement must be agreed to in order to be submitted.")
        }

        // TODO disable the form submit button and change its value to "Processing"
        const submitButton = form.find("button[type=submit]");
        submitButton.prop("disable", true);
        submitButton.val('(Processing…)');


        await api.contributorSignature.create(
          {
            contributorSignature: { name: name, email: email, gitHubUsername: gitHubUsername }
          }
        );

        // If we’re here report all good and go somewhere? Maybe back to github?
        console.log("All good huzzah")

      } catch (error) {
        if (error) {

          const submitButton = form.find("button[type=submit]");
          submitButton.prop("disable", true);
          submitButton.val('Submit');

          // Loop through each form input
          //  Check it against the validation errors and

          for (const fieldName of [
            "name", "email", "gitHubUsername"
          ]) {

            // Check for validation problems given error
            const validationError = error.validationErrors.find( validationError => validationError.apiIdentifier == fieldName );

            const inputForField = form.find(`#${fieldName}`);

            if(validationError) {

              if (validationError.message == "is not unique") {
                // just resubmit a request to GitHub to check the status
                // and inform the user about what’s going on

              } else {
                inputForField.addClass('is-invalid');

                // Add error description
                console.log(`${validationError.apiIdentifier} ${validationError.message}`);
              }
            } else {
              inputForField.addClass('is-valid');
            }

          }

          // On error uniqueness send a request to Gadget to re-process the webhook to notify GitHub to reprocess
          // OR can I send a request to GitHub to do that?
          //
          // Signal to user that it looks like this username and email have already signed the agreement so we’ll signal GitHub to reprocess the check on PRs blocked on signing the agreement
        }
      }
    });

  });
</script>
